---
// Top clients table component for dashboard

const {usertype} = Astro.props;
---

<div class="bg-white shadow rounded-lg p-6">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-lg font-medium text-gray-900"> {usertype}</h3>
      
    </div>
    
    <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex items-center gap-2">
        <label for="table-search" class="text-sm text-gray-600">Search:</label>
        <input id="table-search" type="text" placeholder="Search by name, region..." class=" p-4 block w-64 rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
      </div>
      <div class="flex items-center gap-2">
        <label for="page-size" class="text-sm text-gray-600">Rows per page:</label>
        <select id="page-size" class=" px-4 py-1.5 rounded-md border-0   text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300  sm:text-sm">
          <option value="5">10</option>
          <option value="10" selected>50</option>
          <option value="25">100</option>
        </select>
      </div>
      

  
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Full Name
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Role
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Status
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Registration
            </th>
            <th scope="col" class="px-6 py-3  text-xs font-medium text-gray-500 uppercase tracking-wider text-center">
                Action
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200" id="data-rows">
          <!-- Client 1 -->
          <tr class="hover:bg-gray-50 border-slate-200">
            <td class="px-6 py-4 whitespace-nowrap ">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <img class="h-10 w-10 rounded-full" src="image/user.png" alt="">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-600">Tenzin Dolma</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap  text-sm text-gray-900">
              Editor
            </td>
            <td class="px-6 py-4 whitespace-nowrap ">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-500 text-white">
                Active
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap ">
              <span class="inline-flex text-gray-600 items-center px-2.5 py-0.5 rounded-full text-xs font-medium ">
                24th August 2025
              </span>
            </td>
            <td class="px-6 py-4  flex justify-between gap-x-6">
                <svg class="w-7 h-7 text-gray-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="square" stroke-linejoin="round" stroke-width="1" d="M7 19H5a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3h1m4-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm7.441 1.559a1.907 1.907 0 0 1 0 2.698l-6.069 6.069L10 19l.674-3.372 6.07-6.07a1.907 1.907 0 0 1 2.697 0Z"/>
                  </svg>
                  
                <svg class="w-7 h-7 text-gray-600 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z"/>
                  </svg>
                  
              </td>
           
          </tr>
  
          <!-- Client 2 -->
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap ">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <img class="h-10 w-10 rounded-full" src="image/user.png" alt="">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-600">Tenzin Gyal</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap  text-sm text-gray-900">
              Kham
            </td>
            <td class="px-6 py-4 whitespace-nowrap ">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-500 text-white">
                Inactive
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap ">
                <span class="inline-flex text-gray-600 items-center px-2.5 py-0.5 rounded-full text-xs font-medium ">
                    20th August 2025
                  </span>
            </td>
            <td class="px-6 py-4  flex justify-between gap-x-6">
                <svg class="w-7 h-7 text-gray-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="square" stroke-linejoin="round" stroke-width="1" d="M7 19H5a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3h1m4-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm7.441 1.559a1.907 1.907 0 0 1 0 2.698l-6.069 6.069L10 19l.674-3.372 6.07-6.07a1.907 1.907 0 0 1 2.697 0Z"/>
                  </svg>
                  
                <svg class="w-7 h-7 text-gray-600 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z"/>
                  </svg>
                  
              </td>
          </tr>

        </tbody>
      </table>
    </div>

    <div class="mt-4 flex flex-col items-center gap-3 sm:flex-row sm:justify-between">
      <div class="text-sm text-gray-600" id="pagination-summary">Showing 0â€“0 of 0</div>
      <div class="flex items-center gap-1" id="pagination-controls">
        <button id="page-prev" class="px-5 py-1 rounded-md border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">Prev</button>
        <div id="page-buttons" class="flex items-center gap-1"></div>
        <button id="page-next" class="px-5 py-1 rounded-md border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">Next</button>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const tbody = document.getElementById('data-rows');
        const allRows = Array.from(tbody.querySelectorAll('tr'));
        const searchInput = document.getElementById('table-search');
        const pageSizeSelect = document.getElementById('page-size');
        const pagePrev = document.getElementById('page-prev');
        const pageNext = document.getElementById('page-next');
        const pageButtons = document.getElementById('page-buttons');
        const summary = document.getElementById('pagination-summary');

        let currentPage = 1;
        let pageSize = parseInt(pageSizeSelect.value, 10);
        let filteredRows = [...allRows];

        function normalize(text) {
          return text.toLowerCase().replace(/\s+/g, ' ').trim();
        }

        function applyFilter() {
          const q = normalize(searchInput.value || '');
          if (!q) {
            filteredRows = [...allRows];
          } else {
            filteredRows = allRows.filter((row) => normalize(row.textContent).includes(q));
          }
          currentPage = 1;
          render();
        }

        function renderPagination(totalPages) {
          pageButtons.innerHTML = '';
          const maxButtons = 5;
          let start = Math.max(1, currentPage - Math.floor(maxButtons / 2));
          let end = Math.min(totalPages, start + maxButtons - 1);
          start = Math.max(1, end - maxButtons + 1);

          for (let p = start; p <= end; p++) {
            const btn = document.createElement('button');
            btn.textContent = String(p);
            btn.className = 'px-3 py-1 rounded-md border text-sm ' + (p === currentPage ? 'bg-indigo-600 text-white border-indigo-600' : 'border-gray-300 text-gray-700 hover:bg-gray-50');
            btn.addEventListener('click', () => {
              currentPage = p;
              render();
            });
            pageButtons.appendChild(btn);
          }

          pagePrev.disabled = currentPage <= 1;
          pageNext.disabled = currentPage >= totalPages;
          pagePrev.classList.toggle('opacity-50', pagePrev.disabled);
          pageNext.classList.toggle('opacity-50', pageNext.disabled);
        }

        function render() {
          const total = filteredRows.length;
          const totalPages = Math.max(1, Math.ceil(total / pageSize));
          currentPage = Math.min(currentPage, totalPages);

          allRows.forEach((r) => { r.style.display = 'none'; });

          const startIdx = (currentPage - 1) * pageSize;
          const endIdx = Math.min(startIdx + pageSize, total);
          for (let i = startIdx; i < endIdx; i++) {
            filteredRows[i].style.display = '';
          }

          const shownStart = total === 0 ? 0 : startIdx + 1;
          const shownEnd = endIdx;
          summary.textContent = `Showing ${shownStart}â€“${shownEnd} of ${total}`;

          renderPagination(totalPages);
        }

        searchInput.addEventListener('input', applyFilter);
        pageSizeSelect.addEventListener('change', () => {
          pageSize = parseInt(pageSizeSelect.value, 10);
          currentPage = 1;
          render();
        });
        pagePrev.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            render();
          }
        });
        pageNext.addEventListener('click', () => {
          const totalPages = Math.max(1, Math.ceil(filteredRows.length / pageSize));
          if (currentPage < totalPages) {
            currentPage++;
            render();
          }
        });

        render();
      });
    </script>
  </div>
  